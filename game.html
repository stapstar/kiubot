<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Таполки - Кликер игра</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --primary-color: #6c5ce7;
            --secondary-color: #a29bfe;
            --dark-color: #2d3436;
            --light-color: #dfe6e9;
            --success-color: #00b894;
            --warning-color: #fdcb6e;
            --danger-color: #d63031;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #1a1a2e;
            color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }

        header {
            padding: 1rem;
            background-color: rgba(26, 26, 46, 0.8);
            border-bottom: 1px solid var(--primary-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(5px);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .user-photo {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 0.5rem;
            border: 2px solid var(--primary-color);
        }

        .logo-text {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .balance-container {
            background-color: rgba(44, 44, 68, 0.8);
            padding: 0.5rem 1rem;
            border-radius: 50px;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        }

        .balance {
            font-weight: bold;
            color: var(--warning-color);
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            text-align: center;
        }

        .click-container {
            position: relative;
            margin: 2rem 0;
        }

        .click-circle {
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, var(--primary-color), #4a3fdb);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 0 30px var(--primary-color);
            transition: transform 0.1s, box-shadow 0.3s;
            position: relative;
            overflow: hidden;
        }

        .click-circle:active {
            transform: scale(0.95);
        }

        .click-circle.disabled {
            opacity: 0.7;
            cursor: not-allowed;
            box-shadow: 0 0 15px var(--dark-color);
        }

        .click-circle .click-text {
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
            z-index: 1;
            user-select: none;
        }

        .click-circle .coins-per-click {
            position: absolute;
            bottom: 15px;
            font-size: 0.9rem;
            color: var(--warning-color);
            z-index: 1;
        }

        .clicks-available {
            position: absolute;
            top: 15px;
            font-size: 1rem;
            color: white;
            background-color: rgba(0, 0, 0, 0.5);
            padding: 0.3rem 0.6rem;
            border-radius: 20px;
            z-index: 1;
        }

        .cooldown-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background-color: rgba(255, 255, 255, 0.3);
            overflow: hidden;
        }

        .cooldown-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--success-color), var(--secondary-color));
            width: 0%;
            transition: width 0.1s linear;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            width: 100%;
            max-width: 500px;
            margin: 1rem 0;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .stat-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--warning-color);
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--light-color);
        }

        .nav {
            display: flex;
            justify-content: space-around;
            width: 100%;
            max-width: 500px;
            margin: 1rem 0;
        }

        .nav-btn {
            background-color: rgba(108, 92, 231, 0.2);
            border: 1px solid var(--primary-color);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-btn:hover {
            background-color: rgba(108, 92, 231, 0.4);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #252545;
            width: 90%;
            max-width: 500px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            max-height: 80vh;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            padding: 1rem;
            background-color: var(--dark-color);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--light-color);
        }

        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.2rem;
        }

        .modal-body {
            padding: 1rem;
            overflow-y: auto;
            flex: 1;
        }

        .upgrade-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            margin-bottom: 0.5rem;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
            transition: background-color 0.3s;
            border-left: 3px solid var(--primary-color);
        }

        .upgrade-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .upgrade-info {
            flex: 1;
        }

        .upgrade-name {
            font-weight: bold;
            margin-bottom: 0.3rem;
            color: var(--light-color);
        }

        .upgrade-description {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
            display: flex;
            flex-direction: column;
            gap: 0.2rem;
        }

        .upgrade-stats {
            display: flex;
            gap: 0.5rem;
            font-size: 0.7rem;
            color: var(--secondary-color);
        }

        .upgrade-stat {
            background-color: rgba(108, 92, 231, 0.2);
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
        }

        .upgrade-price {
            font-weight: bold;
            color: var(--warning-color);
            margin-left: 1rem;
            min-width: 80px;
            text-align: right;
        }

        .buy-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-left: 1rem;
            font-weight: bold;
        }

        .buy-btn:hover {
            background-color: #5649d1;
        }

        .buy-btn:disabled {
            background-color: var(--dark-color);
            color: rgba(255, 255, 255, 0.5);
            cursor: not-allowed;
        }

        .tab-container {
            display: flex;
            border-bottom: 1px solid var(--primary-color);
        }

        .tab-btn {
            flex: 1;
            padding: 0.7rem;
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s;
            border-bottom: 3px solid transparent;
        }

        .tab-btn.active {
            border-bottom: 3px solid var(--primary-color);
            background-color: rgba(108, 92, 231, 0.2);
        }

        .tab-content {
            display: none;
            padding: 1rem 0;
        }

        .tab-content.active {
            display: block;
        }

        .achievement-item {
            display: flex;
            align-items: center;
            padding: 0.7rem;
            margin-bottom: 0.5rem;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
            border-left: 3px solid transparent;
            transition: border-color 0.3s;
        }

        .achievement-item.completed {
            border-left-color: var(--success-color);
            background-color: rgba(0, 184, 148, 0.1);
        }

        .achievement-icon {
            width: 40px;
            height: 40px;
            background-color: var(--secondary-color);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-right: 1rem;
            flex-shrink: 0;
        }

        .achievement-info {
            flex: 1;
        }

        .achievement-name {
            font-weight: bold;
            margin-bottom: 0.3rem;
            color: var(--light-color);
        }

        .achievement-description {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .achievement-reward {
            font-size: 0.7rem;
            color: var(--warning-color);
            margin-top: 0.2rem;
        }

        .achievement-progress {
            width: 100%;
            height: 5px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            margin-top: 0.3rem;
            overflow: hidden;
        }

        .achievement-progress-bar {
            height: 100%;
            background-color: var(--success-color);
            width: 0%;
        }

        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--success-color);
            color: white;
            padding: 0.7rem 1.2rem;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
            transform: translateX(150%);
            transition: transform 0.3s;
            z-index: 1001;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            background-color: var(--danger-color);
        }

        .notification.warning {
            background-color: var(--warning-color);
            color: var(--dark-color);
        }

        .floating-coin {
            position: absolute;
            width: 30px;
            height: 30px;
            background-color: var(--warning-color);
            border-radius: 50%;
            pointer-events: none;
            opacity: 0;
            animation: float-coin 1s forwards;
            display: flex;
            justify-content: center;
            align-items: center;
            color: var(--dark-color);
            font-weight: bold;
            z-index: 10;
        }

        @keyframes float-coin {
            0% {
                transform: translateY(0) scale(0.5);
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) scale(1.2);
                opacity: 0;
            }
        }

        .passive-income {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background-color: rgba(44, 44, 68, 0.8);
            padding: 0.5rem 1rem;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .passive-income-value {
            color: var(--warning-color);
            font-weight: bold;
        }

        footer {
            padding: 1rem;
            text-align: center;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.5);
            background-color: rgba(26, 26, 46, 0.8);
            border-top: 1px solid var(--primary-color);
        }

        @media (max-width: 600px) {
            .click-circle {
                width: 150px;
                height: 150px;
            }

            .stats {
                flex-direction: column;
                gap: 1rem;
            }

.referral-link {
    background-color: rgba(255,255,255,0.1);
    padding: 0.5rem;
    border-radius: 5px;
    margin: 0.5rem 0;
    cursor: pointer;
    transition: background-color 0.3s;
}

.referral-link:hover {
    background-color: rgba(255,255,255,0.2);
}

.streak-counter {
    color: var(--warning-color);
    font-weight: bold;
    margin-left: 0.5rem;
}



        }
    </style>
</head>
<body>
    <header>
        <div class="logo">
            <img src="" alt="Фото профиля" class="user-photo" id="userPhoto">
            <div class="logo-text">
                <i class="fas fa-coins"></i>
                <span>KIUCOIN</span>
            </div>
        </div>
        <div class="balance-container">
            <i class="fas fa-coins"></i>
            <span class="balance">0</span>
        </div>
    </header>

    <div class="main-content">
        <div class="click-container">
            <div class="click-circle" id="clickCircle">
                <span class="clicks-available" id="clicksAvailable">20/20</span>
                <span class="click-text">Клик!</span>
                <span class="coins-per-click">+<span id="coinsPerClick">1</span></span>
                <div class="cooldown-progress">
                    <div class="cooldown-progress-bar" id="cooldownProgressBar"></div>
                </div>
            </div>
        </div>

        <div class="stats">
            <div class="stat-item">
                <span class="stat-value" id="totalClicks">0</span>
                <span class="stat-label">Кликов</span>
            </div>
            <div class="stat-item">
                <span class="stat-value" id="clicksPerMinute">0</span>
                <span class="stat-label">Кликов/мин</span>
            </div>
            <div class="stat-item">
                <span class="stat-value" id="totalCoins">0</span>
                <span class="stat-label">Всего монет</span>
            </div>
        </div>

        <div class="nav">
            <button class="nav-btn" id="upgradesBtn">
                <i class="fas fa-cubes"></i>
                Улучшения
            </button>
            <button class="nav-btn" id="achievementsBtn">
                <i class="fas fa-trophy"></i>
                Достижения
            </button>
            <button class="nav-btn" id="bonusesBtn">
                <i class="fas fa-gift"></i>
                Бонусы
            </button>
        </div>
    </div>

    <div class="passive-income">
        <i class="fas fa-clock"></i>
        <span>Пассивный доход:</span>
        <span class="passive-income-value" id="passiveIncomeValue">0</span>
        <span>монет/сек</span>
    </div>

    <footer>
        KIUCOIN - кликер игра © 2025 | Все права защищены
    </footer>

    <!-- Модальное окно улучшений -->
    <div class="modal" id="upgradesModal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="modal-title">Улучшения</span>
                <button class="close-btn" id="closeUpgradesModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="tab-container">
                    <button class="tab-btn active" data-tab="clickUpgrades">Клик</button>
                    <button class="tab-btn" data-tab="passiveUpgrades">Пассивный</button>
                    <button class="tab-btn" data-tab="clickLimitUpgrades">Лимит</button>
                </div>

                <div class="tab-content active" id="clickUpgrades">
                    <div class="upgrade-item">
                        <div class="upgrade-info">
                            <div class="upgrade-name">Сила клика</div>
                            <div class="upgrade-description">
                                Увеличивает количество монет за клик
                                <div class="upgrade-stats">
                                    <span class="upgrade-stat">Текущий уровень: <span id="clickPowerLevel">0</span></span>
                                    <span class="upgrade-stat">+<span id="clickPowerEffect">1</span> монет/клик</span>
                                </div>
                            </div>
                        </div>
                        <span class="upgrade-price" id="clickPowerPrice">100</span>
                        <button class="buy-btn" id="buyClickPower">Купить</button>
                    </div>
                    <div class="upgrade-item">
                        <div class="upgrade-info">
                            <div class="upgrade-name">Скорость клика</div>
                            <div class="upgrade-description">
                                Увеличивает скорость восстановления кликов
                                <div class="upgrade-stats">
                                    <span class="upgrade-stat">Текущий уровень: <span id="clickSpeedLevel">0</span></span>
                                    <span class="upgrade-stat">+<span id="clickSpeedEffect">1</span> клик/15сек</span>
                                </div>
                            </div>
                        </div>
                        <span class="upgrade-price" id="clickSpeedPrice">500</span>
                        <button class="buy-btn" id="buyClickSpeed">Купить</button>
                    </div>
                </div>

                <div class="tab-content" id="passiveUpgrades">
                    <div class="upgrade-item">
                        <div class="upgrade-info">
                            <div class="upgrade-name">Пассивный доход</div>
                            <div class="upgrade-description">
                                Добавляет постоянный доход монет
                                <div class="upgrade-stats">
                                    <span class="upgrade-stat">Текущий уровень: <span id="passiveIncomeLevel">0</span></span>
                                    <span class="upgrade-stat">+<span id="passiveIncomeEffect">0.1</span> монет/сек</span>
                                </div>
                            </div>
                        </div>
                        <span class="upgrade-price" id="passiveIncomePrice">1000</span>
                        <button class="buy-btn" id="buyPassiveIncome">Купить</button>
                    </div>
                    <div class="upgrade-item">
                        <div class="upgrade-info">
                            <div class="upgrade-name">Инвестиции</div>
                            <div class="upgrade-description">
                                Увеличивает пассивный доход пропорционально балансу
                                <div class="upgrade-stats">
                                    <span class="upgrade-stat">Текущий уровень: <span id="investmentsLevel">0</span></span>
                                    <span class="upgrade-stat">+<span id="investmentsEffect">0.01</span>% от баланса/сек</span>
                                </div>
                            </div>
                        </div>
                        <span class="upgrade-price" id="investmentsPrice">5000</span>
                        <button class="buy-btn" id="buyInvestments">Купить</button>
                    </div>
                </div>

                <div class="tab-content" id="clickLimitUpgrades">
                    <div class="upgrade-item">
                        <div class="upgrade-info">
                            <div class="upgrade-name">Увеличение лимита</div>
                            <div class="upgrade-description">
                                Увеличивает максимальное количество доступных кликов
                                <div class="upgrade-stats">
                                    <span class="upgrade-stat">Текущий уровень: <span id="clickLimitLevel">0</span></span>
                                    <span class="upgrade-stat">+<span id="clickLimitEffect">5</span> макс. кликов</span>
                                </div>
                            </div>
                        </div>
                        <span class="upgrade-price" id="clickLimitPrice">2000</span>
                        <button class="buy-btn" id="buyClickLimit">Купить</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно достижений -->
    <div class="modal" id="achievementsModal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="modal-title">Достижения</span>
                <button class="close-btn" id="closeAchievementsModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="achievement-item" id="achievementFirstClick">
                    <div class="achievement-icon">
                        <i class="fas fa-hand-pointer"></i>
                    </div>
                    <div class="achievement-info">
                        <div class="achievement-name">Первый клик</div>
                        <div class="achievement-description">Сделайте ваш первый клик</div>
                        <div class="achievement-reward">Награда: +50 монет</div>
                        <div class="achievement-progress">
                            <div class="achievement-progress-bar" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
                <div class="achievement-item" id="achievementThousandCoins">
                    <div class="achievement-icon">
                        <i class="fas fa-coins"></i>
                    </div>
                    <div class="achievement-info">
                        <div class="achievement-name">Первая тысяча</div>
                        <div class="achievement-description">Заработайте 1000 монет</div>
                        <div class="achievement-reward">Награда: +200 монет</div>
                        <div class="achievement-progress">
                            <div class="achievement-progress-bar" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
                <div class="achievement-item" id="achievementHundredClicks">
                    <div class="achievement-icon">
                        <i class="fas fa-user-ninja"></i>
                    </div>
                    <div class="achievement-info">
                        <div class="achievement-name">Скорость самурая</div>
                        <div class="achievement-description">Сделайте 100 кликов</div>
                        <div class="achievement-reward">Награда: Увеличивает скорость клика на 10%</div>
                        <div class="achievement-progress">
                            <div class="achievement-progress-bar" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
                <div class="achievement-item" id="achievementMillioner">
                    <div class="achievement-icon">
                        <i class="fas fa-money-bill-wave"></i>
                    </div>
                    <div class="achievement-info">
                        <div class="achievement-name">Миллионер</div>
                        <div class="achievement-description">Заработайте 1,000,000 монет</div>
                        <div class="achievement-reward">Награда: Увеличивает пассивный доход на 20%</div>
                        <div class="achievement-progress">
                            <div class="achievement-progress-bar" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
                <div class="achievement-item" id="achievementClickMaster">
                    <div class="achievement-icon">
                        <i class="fas fa-mouse"></i>
                    </div>
                    <div class="achievement-info">
                        <div class="achievement-name">Мастер клика</div>
                        <div class="achievement-description">Сделайте 10,000 кликов</div>
                        <div class="achievement-reward">Награда: Увеличивает доход за клик на 15%</div>
                        <div class="achievement-progress">
                            <div class="achievement-progress-bar" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
                <div class="achievement-item" id="achievementUpgrader">
                    <div class="achievement-icon">
                        <i class="fas fa-crown"></i>
                    </div>
                    <div class="achievement-info">
                        <div class="achievement-name">Прокачка</div>
                        <div class="achievement-description">Купите 50 улучшений</div>
                        <div class="achievement-reward">Награда: Все улучшения дешевле на 10%</div>
                        <div class="achievement-progress">
                            <div class="achievement-progress-bar" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
                <div class="achievement-item" id="achievementPatience">
                    <div class="achievement-icon">
                        <i class="fas fa-hourglass-half"></i>
                    </div>
                    <div class="achievement-info">
                        <div class="achievement-name">Терпение</div>
                        <div class="achievement-description">Играйте более 24 часов</div>
                        <div class="achievement-reward">Награда: +1000 монет/час пока игра открыта</div>
                        <div class="achievement-progress">
                            <div class="achievement-progress-bar" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
                <div class="achievement-item" id="achievementRich">
                    <div class="achievement-icon">
                        <i class="fas fa-piggy-bank"></i>
                    </div>
                    <div class="achievement-info">
                        <div class="achievement-name">Богач</div>
                        <div class="achievement-description">Соберите 10,000 монет не тратя их</div>
                        <div class="achievement-reward">Награда: +10% к максимальному лимиту кликов</div>
                        <div class="achievement-progress">
                            <div class="achievement-progress-bar" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
                <div class="achievement-item" id="achievementSpeedster">
                    <div class="achievement-icon">
                        <i class="fas fa-bolt"></i>
                    </div>
                    <div class="achievement-info">
                        <div class="achievement-name">Скорость</div>
                        <div class="achievement-description">Сделайте 30 кликов за 10 секунд</div>
                        <div class="achievement-reward">Награда: Увеличивает скорость восстановления на 30%</div>
                        <div class="achievement-progress">
                            <div class="achievement-progress-bar" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


<!-- Модальное окно бонусов -->
<div class="modal" id="bonusesModal">
    <div class="modal-content">
        <div class="modal-header">
            <span class="modal-title">Бонусы</span>
            <button class="close-btn" id="closeBonusesModal">&times;</button>
        </div>
        <div class="modal-body">
            <div class="tab-container">
                <button class="tab-btn active" data-tab="dailyBonuses">Ежедневные</button>
                <button class="tab-btn" data-tab="referralBonuses">Реферальные</button>
            </div>

            <div class="tab-content active" id="dailyBonuses">
                <div class="upgrade-item">
                    <div class="upgrade-info">
                        <div class="upgrade-name">Ежедневная награда</div>
                        <div class="upgrade-description">
                            Получайте бонусы за ежедневный вход в игру
                            <div class="upgrade-stats">
                                <span class="upgrade-stat">Текущая серия: <span id="currentStreak">0</span> дней</span>
                                <span class="upgrade-stat">Следующая награда: <span id="nextReward">100</span> монет</span>
                            </div>
                        </div>
                    </div>
                    <button class="buy-btn" id="claimDailyBonus">Получить</button>
                </div>
                
                <div class="upgrade-item">
                    <div class="upgrade-info">
                        <div class="upgrade-name">Ежемесячный челлендж</div>
                        <div class="upgrade-description">
                            Входите в игру 30 дней подряд для супер-приза
                            <div class="upgrade-stats">
                                <span class="upgrade-stat">Прогресс: <span id="monthProgress">0</span>/30 дней</span>
                                <span class="upgrade-stat">Награда: <span id="monthReward">5000</span> монет</span>
                            </div>
                        </div>
                    </div>
                    <div class="achievement-progress">
                        <div class="achievement-progress-bar" id="monthProgressBar" style="width: 0%"></div>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="referralBonuses">
                <div class="upgrade-item">
                    <div class="upgrade-info">
                        <div class="upgrade-name">Реферальная программа</div>
                        <div class="upgrade-description">
                            Приглашайте друзей и получайте бонусы
                            <div class="upgrade-stats">
                                <span class="upgrade-stat">Приглашено: <span id="referralCount">0</span> друзей</span>
                                <span class="upgrade-stat">Бонус за друга: <span id="referralReward">500</span> монет</span>
                            </div>
                        </div>
                    </div>
                    <button class="buy-btn" id="copyReferralLink">Скопировать ссылку</button>
                </div>
                
                <div class="upgrade-item">
                    <div class="upgrade-info">
                        <div class="upgrade-name">Командный бонус</div>
                        <div class="upgrade-description">
                            Получайте 5% от дохода приглашенных друзей
                            <div class="upgrade-stats">
                                <span class="upgrade-stat">Всего заработано: <span id="totalReferralIncome">0</span> монет</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>




    <!-- Уведомление -->
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notificationText">Уведомление</span>
    </div>

    <script>
        // Инициализация игры
        const gameState = {
            coins: 0,
            totalCoins: 0,
            totalClicks: 0,
            clicksAvailable: 20,
            maxClicks: 20,
            lastClickTime: 0,
            clicksPerSecond: 0,
            clicksPerMinute: 0,
            clickValue: 1,
            passiveIncome: 0,
            coinsEarnedPassively: 0,
            
            // Улучшения
            upgrades: {
                clickPower: {
                    level: 0,
                    effect: 1,
                    basePrice: 100,
                    price: 100
                },
                clickSpeed: {
                    level: 0,
                    effect: 1,
                    basePrice: 500,
                    price: 500
                },
                passiveIncome: {
                    level: 0,
                    effect: 0.1,
                    basePrice: 1000,
                    price: 1000
                },
                investments: {
                    level: 0,
                    effect: 0.01,
                    basePrice: 5000,
                    price: 5000
                },
                clickLimit: {
                    level: 0,
                    effect: 5,
                    basePrice: 2000,
                    price: 2000
                }
            },
            
            // Достижения
            achievements: {
                firstClick: {
                    completed: false,
                    progress: 0,
                    required: 1,
                    reward: 50
                },
                thousandCoins: {
                    completed: false,
                    progress: 0,
                    required: 1000,
                    reward: 200
                },
                hundredClicks: {
                    completed: false,
                    progress: 0,
                    required: 100,
                    reward: 'clickSpeedBoost'
                },
                millioner: {
                    completed: false,
                    progress: 0,
                    required: 1000000,
                    reward: 'passiveIncomeBoost'
                },
                clickMaster: {
                    completed: false,
                    progress: 0,
                    required: 10000,
                    reward: 'clickPowerBoost'
                },
                upgrader: {
                    completed: false,
                    progress: 0,
                    required: 50,
                    reward: 'discountBoost'
                },
                patience: {
                    completed: false,
                    progress: 0,
                    required: 86400, // 24 часа в секундах
                    reward: 'hourlyBonus'
                },
                rich: {
                    completed: false,
                    progress: 0,
                    required: 10000,
                    reward: 'clickLimitBoost'
                },
                speedster: {
                    completed: false,
                    progress: 0,
                    required: 30, // кликов за 10 секунд
                    reward: 'clickRegenBoost'
                }
            },
            
            // Бонусы и модификаторы
            modifiers: {
                clickPowerBoost: 1,
                clickSpeedBoost: 1,
                passiveIncomeBoost: 1,
                discountBoost: 1,
                clickRegenBoost: 1,
                clickLimitBoost: 1
            },
            

bonuses: {
    lastLogin: null,
    loginStreak: 0,
    totalLoginDays: 0,
    referrals: 0,
    referralIncome: 0,
    referralCode: generateReferralCode()
},


            // Временные данные
            highScore: 0,
            gameStartTime: Date.now(),
            lastUpdateTime: Date.now(),
            clickHistory: [],
            lastClickTimestamps: []
        };

        // DOM элементы
        const elements = {
            balance: document.querySelector('.balance'),
            totalClicks: document.getElementById('totalClicks'),
            clicksPerMinute: document.getElementById('clicksPerMinute'),
            totalCoins: document.getElementById('totalCoins'),
            clickCircle: document.getElementById('clickCircle'),
            clicksAvailable: document.getElementById('clicksAvailable'),
            coinsPerClick: document.getElementById('coinsPerClick'),
            cooldownProgressBar: document.getElementById('cooldownProgressBar'),
            passiveIncomeValue: document.getElementById('passiveIncomeValue'),
            
            // Модальные окна
            upgradesModal: document.getElementById('upgradesModal'),
            achievementsModal: document.getElementById('achievementsModal'),
            
            // Кнопки
            upgradesBtn: document.getElementById('upgradesBtn'),
            achievementsBtn: document.getElementById('achievementsBtn'),
            bonusesBtn: document.getElementById('bonusesBtn'),
            closeUpgradesModal: document.getElementById('closeUpgradesModal'),
            closeAchievementsModal: document.getElementById('closeAchievementsModal'),
            
            // Улучшения
            clickPowerLevel: document.getElementById('clickPowerLevel'),
            clickPowerEffect: document.getElementById('clickPowerEffect'),
            clickPowerPrice: document.getElementById('clickPowerPrice'),
            buyClickPower: document.getElementById('buyClickPower'),
            
            clickSpeedLevel: document.getElementById('clickSpeedLevel'),
            clickSpeedEffect: document.getElementById('clickSpeedEffect'),
            clickSpeedPrice: document.getElementById('clickSpeedPrice'),
            buyClickSpeed: document.getElementById('buyClickSpeed'),
            
            passiveIncomeLevel: document.getElementById('passiveIncomeLevel'),
            passiveIncomeEffect: document.getElementById('passiveIncomeEffect'),
            passiveIncomePrice: document.getElementById('passiveIncomePrice'),
            buyPassiveIncome: document.getElementById('buyPassiveIncome'),
            
            investmentsLevel: document.getElementById('investmentsLevel'),
            investmentsEffect: document.getElementById('investmentsEffect'),
            investmentsPrice: document.getElementById('investmentsPrice'),
            buyInvestments: document.getElementById('buyInvestments'),
            
            clickLimitLevel: document.getElementById('clickLimitLevel'),
            clickLimitEffect: document.getElementById('clickLimitEffect'),
            clickLimitPrice: document.getElementById('clickLimitPrice'),
            buyClickLimit: document.getElementById('buyClickLimit'),
            
            // Уведомления
            notification: document.getElementById('notification'),
            notificationText: document.getElementById('notificationText'),
            
            // Фото пользователя
            userPhoto: document.getElementById('userPhoto')
        };

        // Telegram WebApp инициализация
        window.Telegram.WebApp.ready();
        const initData = window.Telegram.WebApp.initData;
        const userData = new URLSearchParams(initData).get('user');

        if (userData) {
            try {
                const user = JSON.parse(decodeURIComponent(userData));
                if (user.photo_url) {
                    elements.userPhoto.src = user.photo_url;
                }
            } catch (e) {
                console.error('Error parsing user data:', e);
            }
        }

        // Функции игры
        function initGame() {
            loadGame();
            updateUI();
            setupEventListeners();
            
            // Запуск игрового цикла
            setInterval(gameLoop, 100);
            setInterval(updateClickStats, 5000);
            setInterval(checkAchievements, 1000);
        }

        function gameLoop() {
            const now = Date.now();
            const deltaTime = (now - gameState.lastUpdateTime) / 1000;
            gameState.lastUpdateTime = now;
            
            // Восстановление кликов
            if (gameState.clicksAvailable < gameState.maxClicks) {
                const clickRegenPerSecond = gameState.upgrades.clickSpeed.effect * gameState.modifiers.clickSpeedBoost / 15;
                const newClicks = clickRegenPerSecond * deltaTime;
                
                gameState.clicksAvailable = Math.min(
                    gameState.maxClicks * gameState.modifiers.clickLimitBoost,
                    gameState.clicksAvailable + newClicks
                );
                
                updateCooldownProgressBar();
            }
            
            // Пассивный доход
            if (gameState.upgrades.passiveIncome.level > 0 || gameState.upgrades.investments.level > 0) {
                let passiveIncome = gameState.upgrades.passiveIncome.effect * gameState.modifiers.passiveIncomeBoost;
                if (gameState.upgrades.investments.level > 0) {
                    passiveIncome += gameState.coins * (gameState.upgrades.investments.effect * gameState.modifiers.passiveIncomeBoost / 100);
                }
                
                const coinsFromPassive = passiveIncome * deltaTime;
                gameState.coins += coinsFromPassive;
                gameState.totalCoins += coinsFromPassive;
                gameState.coinsEarnedPassively += coinsFromPassive;
                
                // Обновляем статистику и UI
                updateUI();
            }
            
            // Проверка достижения "Терпение"
            if (!gameState.achievements.patience.completed) {
                gameState.achievements.patience.progress = (now - gameState.gameStartTime) / 1000;
            }
            
            // Обновляем UI каждые 100мс
            updateUI();
        }

        function updateClickStats() {
            const now = Date.now();
            gameState.clickHistory = gameState.clickHistory.filter(clickTime => now - clickTime < 60000);
            gameState.clicksPerMinute = gameState.clickHistory.length;
            
            // Проверка достижения "Скорость"
            if (!gameState.achievements.speedster.completed) {
                gameState.lastClickTimestamps = gameState.lastClickTimestamps.filter(ts => now - ts < 10000);
                if (gameState.lastClickTimestamps.length >= 30) {
                    completeAchievement('speedster');
                }
            }
        }



// Генерация реферального кода
function generateReferralCode() {
    return Math.random().toString(36).substr(2, 8).toUpperCase();
}

// Проверка ежедневного бонуса
function checkDailyBonus() {
    const today = new Date().toDateString();
    if (gameState.bonuses.lastLogin !== today) {
        gameState.bonuses.lastLogin = today;
        gameState.bonuses.loginStreak++;
        gameState.bonuses.totalLoginDays++;
        
        const reward = 100 + (gameState.bonuses.loginStreak - 1) * 50;
        gameState.coins += reward;
        gameState.totalCoins += reward;
        
        showNotification(`Ежедневный бонус: +${reward} монет! Серия: ${gameState.bonuses.loginStreak} дней`, 'success');
        saveGame();
    }
}

// Обновление бонусов в UI
function updateBonusesUI() {
    document.getElementById('currentStreak').textContent = gameState.bonuses.loginStreak;
    document.getElementById('nextReward').textContent = 100 + (gameState.bonuses.loginStreak) * 50;
    document.getElementById('monthProgress').textContent = gameState.bonuses.totalLoginDays % 30;
    document.getElementById('monthReward').textContent = 5000;
    document.getElementById('monthProgressBar').style.width = `${(gameState.bonuses.totalLoginDays % 30) / 30 * 100}%`;
    
    document.getElementById('referralCount').textContent = gameState.bonuses.referrals;
    document.getElementById('referralReward').textContent = 500;
    document.getElementById('totalReferralIncome').textContent = gameState.bonuses.referralIncome;
}


        function updateUI() {
            // Обновление баланса
            elements.balance.textContent = Math.floor(gameState.coins).toLocaleString();
            elements.totalClicks.textContent = gameState.totalClicks.toLocaleString();
            elements.clicksPerMinute.textContent = gameState.clicksPerMinute.toLocaleString();
            elements.totalCoins.textContent = Math.floor(gameState.totalCoins).toLocaleString();
            
            // Обновление кликов
            elements.clicksAvailable.textContent = `${Math.floor(gameState.clicksAvailable)}/${Math.floor(gameState.maxClicks * gameState.modifiers.clickLimitBoost)}`;
            elements.coinsPerClick.textContent = `+${Math.floor(gameState.clickValue * gameState.modifiers.clickPowerBoost)}`;
            
            // Обновление пассивного дохода
            let passiveIncome = gameState.upgrades.passiveIncome.effect * gameState.modifiers.passiveIncomeBoost;
            if (gameState.upgrades.investments.level > 0) {
                passiveIncome += gameState.coins * (gameState.upgrades.investments.effect * gameState.modifiers.passiveIncomeBoost / 100);
            }
            elements.passiveIncomeValue.textContent = passiveIncome.toFixed(2);
            
            // Обновление улучшений
            elements.clickPowerLevel.textContent = gameState.upgrades.clickPower.level;
            elements.clickPowerEffect.textContent = gameState.upgrades.clickPower.effect;
            elements.clickPowerPrice.textContent = gameState.upgrades.clickPower.price;
            
            elements.clickSpeedLevel.textContent = gameState.upgrades.clickSpeed.level;
            elements.clickSpeedEffect.textContent = gameState.upgrades.clickSpeed.effect;
            elements.clickSpeedPrice.textContent = gameState.upgrades.clickSpeed.price;
            
            elements.passiveIncomeLevel.textContent = gameState.upgrades.passiveIncome.level;
            elements.passiveIncomeEffect.textContent = gameState.upgrades.passiveIncome.effect;
            elements.passiveIncomePrice.textContent = gameState.upgrades.passiveIncome.price;
            
            elements.investmentsLevel.textContent = gameState.upgrades.investments.level;
            elements.investmentsEffect.textContent = gameState.upgrades.investments.effect;
            elements.investmentsPrice.textContent = gameState.upgrades.investments.price;
            
            elements.clickLimitLevel.textContent = gameState.upgrades.clickLimit.level;
            elements.clickLimitEffect.textContent = gameState.upgrades.clickLimit.effect;
            elements.clickLimitPrice.textContent = gameState.upgrades.clickLimit.price;
            
            // Обновление кнопок улучшений
            elements.buyClickPower.disabled = gameState.coins < gameState.upgrades.clickPower.price;
            elements.buyClickSpeed.disabled = gameState.coins < gameState.upgrades.clickSpeed.price;
            elements.buyPassiveIncome.disabled = gameState.coins < gameState.upgrades.passiveIncome.price;
            elements.buyInvestments.disabled = gameState.coins < gameState.upgrades.investments.price;
            elements.buyClickLimit.disabled = gameState.coins < gameState.upgrades.clickLimit.price;
            
            // Обновление прогресса достижений
            updateAchievementProgress('firstClick', gameState.totalClicks);
            updateAchievementProgress('thousandCoins', gameState.totalCoins);
            updateAchievementProgress('hundredClicks', gameState.totalClicks);
            updateAchievementProgress('millioner', gameState.totalCoins);
            updateAchievementProgress('clickMaster', gameState.totalClicks);
            updateAchievementProgress('upgrader', Object.values(gameState.upgrades).reduce((sum, upgrade) => sum + upgrade.level, 0));
            updateAchievementProgress('rich', gameState.coins);
        }

        function updateCooldownProgressBar() {
            const progress = (gameState.clicksAvailable / (gameState.maxClicks * gameState.modifiers.clickLimitBoost)) * 100;
            elements.cooldownProgressBar.style.width = `${progress}%`;
        }

        function updateAchievementProgress(achievementId, currentProgress) {
            const achievement = gameState.achievements[achievementId];
            if (!achievement.completed) {
                achievement.progress = Math.min(currentProgress, achievement.required);
                const progressBar = document.getElementById(`achievement${achievementId.charAt(0).toUpperCase() + achievementId.slice(1)}`).querySelector('.achievement-progress-bar');
                progressBar.style.width = `${(achievement.progress / achievement.required) * 100}%`;
                
                if (achievement.progress >= achievement.required) {
                    completeAchievement(achievementId);
                }
            }
        }



function sendDataToServer() {
    const telegramId = window.Telegram.WebApp.initDataUnsafe.user.id;
    const data = {
        telegram_id: telegramId,
        progress: {
            tokens: gameState.coins,
            total_tokens: gameState.totalCoins,
            clicks: gameState.totalClicks
        },
        upgrades: {
            click_power_level: gameState.upgrades.clickPower.level,
            click_speed_level: gameState.upgrades.clickSpeed.level,
            passive_income_level: gameState.upgrades.passiveIncome.level
        },
        achievements: {
            achievement_id: Object.entries(gameState.achievements)
                .filter(([_, ach]) => ach.completed)
                .map(([id, _]) => id)
        }
    };

    fetch('https://ваш-сайт.com/api/save_game_data.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
    });
}

// Автосохранение каждые 30 секунд
setInterval(sendDataToServer, 30000);



        function completeAchievement(achievementId) {
            const achievement = gameState.achievements[achievementId];
            if (achievement.completed) return;
            
            achievement.completed = true;
            const achievementElement = document.getElementById(`achievement${achievementId.charAt(0).toUpperCase() + achievementId.slice(1)}`);
            achievementElement.classList.add('completed');
            
            // Применяем награду
            if (typeof achievement.reward === 'number') {
                gameState.coins += achievement.reward;
                gameState.totalCoins += achievement.reward;
                showNotification(`Достижение получено: +${achievement.reward} монет!`);
            } else {
                switch (achievement.reward) {
                    case 'clickSpeedBoost':
                        gameState.modifiers.clickSpeedBoost *= 1.1;
                        showNotification('Достижение получено: +10% к скорости восстановления кликов!');
                        break;
                    case 'passiveIncomeBoost':
                        gameState.modifiers.passiveIncomeBoost *= 1.2;
                        showNotification('Достижение получено: +20% к пассивному доходу!');
                        break;
                    case 'clickPowerBoost':
                        gameState.modifiers.clickPowerBoost *= 1.15;
                        showNotification('Достижение получено: +15% к доходу за клик!');
                        break;
                    case 'discountBoost':
                        gameState.modifiers.discountBoost = 0.9;
                        showNotification('Достижение получено: все улучшения дешевле на 10%!');
                        break;
                    case 'clickRegenBoost':
                        gameState.modifiers.clickRegenBoost *= 1.3;
                        showNotification('Достижение получено: +30% к скорости восстановления кликов!');
                        break;
                    case 'clickLimitBoost':
                        gameState.modifiers.clickLimitBoost *= 1.1;
                        showNotification('Достижение получено: +10% к максимальному лимиту кликов!');
                        break;
                }
            }
        }

        function checkAchievements() {
            // Проверка достижения "Богач" (если у нас больше 10000 монет и мы ничего не купили)
            if (!gameState.achievements.rich.completed && gameState.coins >= 10000 && gameState.upgrades.clickPower.level === 0 && 
                gameState.upgrades.clickSpeed.level === 0 && gameState.upgrades.passiveIncome.level === 0 &&
                gameState.upgrades.investments.level === 0 && gameState.upgrades.clickLimit.level === 0) {
                completeAchievement('rich');
            }
        }

        function showNotification(text, type = 'success') {
            elements.notification.className = 'notification';
            if (type === 'error') {
                elements.notification.classList.add('error');
            } else if (type === 'warning') {
                elements.notification.classList.add('warning');
            }
            
            elements.notificationText.textContent = text;
            elements.notification.classList.add('show');
            
            setTimeout(() => {
                elements.notification.classList.remove('show');
            }, 3000);
        }

        // Обработка кликов
        function handleClick() {
            if (gameState.clicksAvailable < 1) return;
            
            gameState.clicksAvailable--;
            const coinsEarned = Math.floor(gameState.clickValue * gameState.modifiers.clickPowerBoost);
            gameState.coins += coinsEarned;
            gameState.totalCoins += coinsEarned;
            gameState.totalClicks++;
            
            const now = Date.now();
            gameState.clickHistory.push(now);
            gameState.lastClickTimestamps.push(now);
            
            // Проверка первого клика
            if (gameState.totalClicks === 1) {
                completeAchievement('firstClick');
            }
            
            // Создаем летающую монетку
            createFloatingCoin(coinsEarned);
            
            updateUI();
        }

        function createFloatingCoin(amount) {
            const coin = document.createElement('div');
            coin.className = 'floating-coin';
            coin.textContent = `+${amount}`;
            
            const circleRect = elements.clickCircle.getBoundingClientRect();
            const x = Math.random() * circleRect.width;
            const y = Math.random() * circleRect.height;
            
            coin.style.left = `${x}px`;
            coin.style.top = `${y}px`;
            
            elements.clickCircle.appendChild(coin);
            
            setTimeout(() => {
                coin.remove();
            }, 1000);
        }

        // Покупка улучшений
        function buyUpgrade(upgradeId) {
            const upgrade = gameState.upgrades[upgradeId];
            if (gameState.coins < upgrade.price) {
                showNotification('Недостаточно монет!', 'error');
                return;
            }
            
            gameState.coins -= upgrade.price;
            upgrade.level++;
            
            // Увеличиваем цену для следующего уровня
            upgrade.price = Math.floor(upgrade.basePrice * Math.pow(1.15, upgrade.level) * gameState.modifiers.discountBoost);
            
            // Применяем эффект улучшения
            switch (upgradeId) {
                case 'clickPower':
                    gameState.clickValue = 1 + upgrade.level * upgrade.effect;
                    break;
                case 'clickSpeed':
                    // Эффект уже применяется в игровом цикле
                    break;
                case 'passiveIncome':
                    // Эффект уже применяется в игровом цикле
                    break;
                case 'investments':
                    // Эффект уже применяется в игровом цикле
                    break;
                case 'clickLimit':
                    gameState.maxClicks = 20 + upgrade.level * upgrade.effect;
                    break;
            }
            
            showNotification(`Улучшение куплено: +${upgrade.effect * (upgradeId === 'clickLimit' ? 1 : upgrade.level)} ${getUpgradeEffectName(upgradeId)}`);
            updateUI();
        }

        function getUpgradeEffectName(upgradeId) {
            switch (upgradeId) {
                case 'clickPower': return 'монет/клик';
                case 'clickSpeed': return 'клик/15сек';
                case 'passiveIncome': return 'монет/сек';
                case 'investments': return '% от баланса/сек';
                case 'clickLimit': return 'макс. кликов';
                default: return '';
                updateBonusesUI();
            }
        }

        // Сохранение и загрузка игры
        function saveGame() {
            const saveData = {
                coins: gameState.coins,
                totalCoins: gameState.totalCoins,
                totalClicks: gameState.totalClicks,
                maxClicks: gameState.maxClicks,
                clickValue: gameState.clickValue,
                passiveIncome: gameState.passiveIncome,
                upgrades: gameState.upgrades,
                achievements: gameState.achievements,
                modifiers: gameState.modifiers,
                gameStartTime: gameState.gameStartTime,
                lastUpdateTime: gameState.lastUpdateTime
            };
            
            localStorage.setItem('tapolkiClickerSave', JSON.stringify(saveData));
        }

        function loadGame() {
            const saveData = JSON.parse(localStorage.getItem('tapolkiClickerSave'));
            if (!saveData) return;
            
            gameState.coins = saveData.coins || 0;
            gameState.totalCoins = saveData.totalCoins || 0;
            gameState.totalClicks = saveData.totalClicks || 0;
            gameState.maxClicks = saveData.maxClicks || 20;
            gameState.clickValue = saveData.clickValue || 1;
            gameState.passiveIncome = saveData.passiveIncome || 0;
            
            if (saveData.upgrades) {
                Object.keys(saveData.upgrades).forEach(upgradeId => {
                    gameState.upgrades[upgradeId] = saveData.upgrades[upgradeId];
                });
            }
            
            if (saveData.achievements) {
                Object.keys(saveData.achievements).forEach(achievementId => {
                    gameState.achievements[achievementId] = saveData.achievements[achievementId];
                    if (gameState.achievements[achievementId].completed) {
                        document.getElementById(`achievement${achievementId.charAt(0).toUpperCase() + achievementId.slice(1)}`).classList.add('completed');
                    }
                });
            }
            
            if (saveData.modifiers) {
                Object.keys(saveData.modifiers).forEach(modifierId => {
                    gameState.modifiers[modifierId] = saveData.modifiers[modifierId];
                });
            }
            
            gameState.gameStartTime = saveData.gameStartTime || Date.now();
            gameState.lastUpdateTime = saveData.lastUpdateTime || Date.now();
            
            // Обновляем UI после загрузки
            updateUI();
        }

function switchUpgradeTabs(activeTab) {
    // Убираем активное состояние у всех кнопок и контента
    document.querySelectorAll('.tab-btn, .tab-content').forEach(element => {
        element.classList.remove('active');
    });
    
    // Добавляем активное состояние выбранной вкладке и контенту
    document.querySelector(`[data-tab="${activeTab}"]`).classList.add('active');
    document.getElementById(activeTab).classList.add('active');
}

       function setupEventListeners() {
    elements.clickCircle.addEventListener('click', handleClick);
    
    elements.upgradesBtn.addEventListener('click', () => {
        elements.upgradesModal.style.display = 'flex';
        switchUpgradeTabs('clickUpgrades');
    });
    
    elements.achievementsBtn.addEventListener('click', () => elements.achievementsModal.style.display = 'flex');
    elements.bonusesBtn.addEventListener('click', () => showNotification('Функция в разработке!', 'warning'));

    // Закрытие модальных окон
    elements.closeUpgradesModal.addEventListener('click', () => elements.upgradesModal.style.display = 'none');
    elements.closeAchievementsModal.addEventListener('click', () => elements.achievementsModal.style.display = 'none');

    // Обработчики для вкладок
    document.querySelectorAll('.tab-btn').forEach(tab => {
        tab.addEventListener('click', function() {
            const targetTab = this.dataset.tab;
            switchUpgradeTabs(targetTab);
        });
    });

    // Правильные обработчики для кнопок покупки
    elements.buyClickPower.addEventListener('click', () => buyUpgrade('clickPower'));
    elements.buyClickSpeed.addEventListener('click', () => buyUpgrade('clickSpeed'));
    elements.buyPassiveIncome.addEventListener('click', () => buyUpgrade('passiveIncome'));
    elements.buyInvestments.addEventListener('click', () => buyUpgrade('investments'));
    elements.buyClickLimit.addEventListener('click', () => buyUpgrade('clickLimit'));


// Бонусы
    document.getElementById('bonusesBtn').addEventListener('click', () => {
        checkDailyBonus();
        elements.bonusesModal.style.display = 'flex';
        switchUpgradeTabs('dailyBonuses');
        updateBonusesUI();
    });
    
    document.getElementById('closeBonusesModal').addEventListener('click', () => {
        elements.bonusesModal.style.display = 'none';
    });
    
    document.getElementById('claimDailyBonus').addEventListener('click', checkDailyBonus);
    
    document.getElementById('copyReferralLink').addEventListener('click', () => {
        navigator.clipboard.writeText(`https://ваш-сайт.com/?ref=${gameState.bonuses.referralCode}`);
        showNotification('Реферальная ссылка скопирована!', 'success');
    });

}

function buyUpgrade(upgradeId) {
    const upgrade = gameState.upgrades[upgradeId];
    if (gameState.coins < upgrade.price) {
        showNotification('Недостаточно монет!', 'error');
        return;
    }
    
    gameState.coins -= upgrade.price;
    upgrade.level++;
    
    // Обновляем цену с учетом скидки
    upgrade.price = Math.floor(
        upgrade.basePrice * 
        Math.pow(1.15, upgrade.level) * 
        gameState.modifiers.discountBoost
    );
    
    // Применяем эффекты
    switch(upgradeId) {
        case 'clickPower':
            gameState.clickValue = 1 + upgrade.level * upgrade.effect;
            break;
        case 'clickLimit':
            gameState.maxClicks = 20 + upgrade.level * upgrade.effect;
            break;
    }
    
    showNotification(`Улучшение куплено! Уровень ${upgrade.level}`);
    saveGame(); // Сохраняем игру после покупки
    updateUI();
}

// Добавляем автосохранение каждые 30 секунд
setInterval(saveGame, 30000);

// Инициализируем игру при загрузке
document.addEventListener('DOMContentLoaded', initGame);

// Функция для отправки данных в бота
function sendDataToBot() {
    const gameData = {
        taps: gameState.totalClicks,
        coins: Math.floor(gameState.coins),
        total_coins: Math.floor(gameState.totalCoins),
        click_power: gameState.clickValue,
        click_speed: gameState.upgrades.clickSpeed.effect * gameState.modifiers.clickSpeedBoost,
        passive_income: gameState.upgrades.passiveIncome.effect * gameState.modifiers.passiveIncomeBoost,
        achievements: Object.entries(gameState.achievements)
            .filter(([_, ach]) => ach.completed)
            .map(([id, _]) => id)
    };
    
    // Отправляем данные в Telegram бота
    window.Telegram.WebApp.sendData(JSON.stringify(gameData));
    
    // Закрываем веб-приложение
    window.Telegram.WebApp.close();
}

// Добавляем кнопку сохранения в интерфейс
function addSaveButton() {
    const saveBtn = document.createElement('button');
    saveBtn.textContent = 'Сохранить и выйти';
    saveBtn.style.position = 'fixed';
    saveBtn.style.bottom = '20px';
    saveBtn.style.right = '20px';
    saveBtn.style.padding = '10px 15px';
    saveBtn.style.backgroundColor = '#6c5ce7';
    saveBtn.style.color = 'white';
    saveBtn.style.border = 'none';
    saveBtn.style.borderRadius = '5px';
    saveBtn.style.cursor = 'pointer';
    saveBtn.style.zIndex = '1000';
    
    saveBtn.addEventListener('click', sendDataToBot);
    
    document.body.appendChild(saveBtn);
}

// Инициализация веб-приложения
document.addEventListener('DOMContentLoaded', function() {
    initGame();
    addSaveButton();
    
    // Автоматически сохраняем данные при закрытии веб-приложения
    window.Telegram.WebApp.onEvent('viewportChanged', function(e) {
        if (e.isStateStable && !window.Telegram.WebApp.isExpanded) {
            sendDataToBot();
        }
    });
});


if (window.Telegram && window.Telegram.WebApp) {
    window.Telegram.WebApp.initDataUnsafe = {
        user: { id: 123456789 },
        chat: null,
        chat_type: null,
        query_id: "",
        auth_date: Math.floor(Date.now() / 1000),
        hash: ""
    };
}


        function sendDataToBot() {
    if (window.Telegram && window.Telegram.WebApp) {
        const gameData = {
            taps: gameState.totalClicks,
            coins: Math.floor(gameState.coins),
            total_coins: Math.floor(gameState.totalCoins),
            click_power: gameState.clickValue,
            click_speed: gameState.upgrades.clickSpeed.level,
            passive_income: gameState.upgrades.passiveIncome.level,
            achievements: Object.keys(gameState.achievements).filter(id => gameState.achievements[id].completed)
        };
        window.Telegram.WebApp.sendData(JSON.stringify(gameData));
        window.Telegram.WebApp.close(); // Закрываем WebApp после отправки
    } else {
        console.warn("Telegram WebApp API недоступен");
    }
}

        
 </script>
</body>
</html>
